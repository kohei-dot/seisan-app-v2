# 精算アプリ 仕様書

## 概要

ポーカーなどのチップゲームにおける精算を行うWebアプリ。
チップの損益と場所代を合算し、最小の送金回数で精算方法を算出する。

**URL**: https://seisan-app.vercel.app/

---

## 技術スタック

| 項目 | 内容 |
|---|---|
| フレームワーク | React 18 + Vite 5 |
| 言語 | TypeScript |
| バックエンド | なし（state管理のみ） |
| デプロイ | Vercel |
| リポジトリ | https://github.com/kohei-dot/seisan-app |

---

## 画面構成

画面遷移はReact stateで管理（ルーティングなし）。

```
セットアップ画面 → 参加者入力画面 → 精算結果画面
                                        ↓（戻る）
                        参加者入力画面 ←
```

---

## 各画面の仕様

### 1. セットアップ画面

| 項目 | 内容 |
|---|---|
| イベント名 | テキスト入力。デフォルト：起動日の日付（例: 2026/02/27） |
| 係数 | 数値入力（円/チップ）。デフォルト：5 |

- 両方入力済みで「次へ」ボタンが有効になる

---

### 2. 参加者入力画面

#### 入力項目（1人につき）

| 項目 | 型 | 備考 |
|---|---|---|
| 名前 | テキスト | |
| 購入チップ | 数値 | inputmode="numeric"（スマホテンキー） |
| 最終チップ | 数値 | inputmode="numeric" |
| 場所代（円） | 数値 | inputmode="numeric"、未入力は0扱い |

#### 操作

- 参加者の追加・削除が可能（最低1人）
- 結果画面から戻った場合、入力内容を保持

#### バリデーション

- 購入チップの合計 ≠ 最終チップの合計の場合、エラーメッセージを表示し結果画面に進めない
- 全員の名前が入力済み かつ 参加者が2人以上でないと「結果を見る」ボタンが無効

---

### 3. 精算結果画面

#### 損益一覧テーブル（横スクロール対応）

| 列 | 内容 |
|---|---|
| 名前 | 参加者名（左端固定） |
| 購入 | 購入チップ数 |
| 最終 | 最終チップ数 |
| チップ損益 | (最終 - 購入) × 係数（円） |
| 場所代 | その人が実際に払った場所代（円） |
| 精算額 | 最終損益（円）。プラス=緑、マイナス=赤 |

#### 精算方法

- 誰が誰にいくら払うかを最小送金数で表示
- 精算不要な場合は「精算は不要です」と表示

#### 端数調整

- 丸め誤差で合計が0にならない場合、最も損している人の精算額を調整
- 調整が発生した場合「端数調整あり」バッジを表示

---

## 計算ロジック

```
チップ損益 = (最終チップ - 購入チップ) × 係数

一人あたり場所代 = 全員の場所代合計 ÷ 参加人数

最終損益（精算額）= チップ損益 + (自分が払った場所代 - 一人あたり場所代)
```

- 端数は円単位で四捨五入
- 丸め後の合計が0にならない場合は最も損している人（最終損益が最も低い人）の値を調整して合計を0にする

### 最小送金数アルゴリズム

1. 全員の精算額を昇順ソート
2. 最も負の人（支払い最大）と最も正の人（受け取り最大）をマッチング
3. 小さい方が0になったらポインタを進める
4. 全員が0になるまで繰り返す

n人の場合、最大 n-1 回の送金で完了する。

---

## ファイル構成

```
1_精算アプリ/
├── index.html
├── package.json
├── vite.config.ts
├── tsconfig.json / tsconfig.app.json / tsconfig.node.json
└── src/
    ├── main.tsx              # エントリーポイント
    ├── App.tsx               # state管理・画面ルーティング
    ├── types.ts              # 型定義
    ├── index.css             # グローバルスタイル
    ├── logic/
    │   └── calculation.ts    # 計算・精算最適化ロジック
    └── components/
        ├── SetupScreen.tsx
        ├── ParticipantScreen.tsx
        └── ResultScreen.tsx
```

### state設計

全stateを `App.tsx` の `useState` 1箇所で管理。

```typescript
{
  screen: 'setup' | 'participants' | 'result'
  eventName: string
  coefficient: string
  participants: Participant[]
}
```

---

## UI

- スマホファーストのレスポンシブデザイン
- 最大幅 480px、中央寄せ
- 操作ボタンは画面下部に固定（action bar）
- テーブルは横スクロール対応、名前列を左端に固定
